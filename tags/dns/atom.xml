<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
    <title>Karl&#x27;s Little World - dns</title>
    <subtitle>...just stuff I thought I should write down and that might be useful to others...</subtitle>
    <link rel="self" type="application/atom+xml" href="https://karldyson.github.io/karld-blog-website/tags/dns/atom.xml"/>
    <link rel="alternate" type="text/html" href="https://karldyson.github.io/karld-blog-website/"/>
    <generator uri="https://www.getzola.org/">Zola</generator>
    <updated>2021-03-02T00:00:00+00:00</updated>
    <id>https://karldyson.github.io/karld-blog-website/tags/dns/atom.xml</id>
    <entry xml:lang="en">
        <title>Blocking Adverts, Tracking &amp; Malware using RPZ</title>
        <published>2021-03-02T00:00:00+00:00</published>
        <updated>2021-03-02T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://karldyson.github.io/karld-blog-website/posts/blocking-adverts-tracking-malware-rpz/"/>
        <id>https://karldyson.github.io/karld-blog-website/posts/blocking-adverts-tracking-malware-rpz/</id>
        
        <content type="html" xml:base="https://karldyson.github.io/karld-blog-website/posts/blocking-adverts-tracking-malware-rpz/">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;&#x2F;h1&gt;
&lt;p&gt;A while back, I decided I wanted to prevent at least some adverts and tracking, but rather than on a device by device basis, I wanted to achieve this for all devices on the network. Those that know me and my recent work will understand that naturally, DNS blocking sprang to mind, as I’m already very familiar with RPZ.&lt;&#x2F;p&gt;
&lt;p&gt;Originally, I was consuming a bunch of lists with some code, manipulating the entries with some weighting and then outputting an RPZ for my servers to use. However, more recently I found &lt;a href=&quot;https:&#x2F;&#x2F;energized.pro&quot;&gt;Energized Protect&lt;&#x2F;a&gt;, which has a load of different levels of blocking, and they provide the different levels in a variety of formats, helpfully including RPZ. So, I’ve been trialling their lists for a couple of weeks now.&lt;&#x2F;p&gt;
&lt;p&gt;As with any external feed, you need to be aware of either false positives being added to the list by the curator, as well as things they think should be on the list that you may disagree with. I was &lt;a href=&quot;https:&#x2F;&#x2F;karldyson.github.io&#x2F;karld-blog-website&#x2F;posts&#x2F;alexa-why-are-you-broken&#x2F;&quot;&gt;recently affected&lt;&#x2F;a&gt; by this with my Amazon devices, whereby one or more domains critical to the correct functioning of the Echo devices found their way onto the block list I’m consuming. To be fair, I’m consuming one of the more extreme variants of the list, and so this was something I was aware could happen (although I admit, it didn’t spring straight to the front of my mind when troubleshooting over the weekend!).&lt;&#x2F;p&gt;
&lt;h1 id=&quot;so-let-s-talk-about-how-rpz-works&quot;&gt;So, let’s talk about how RPZ works.&lt;&#x2F;h1&gt;
&lt;p&gt;RPZ is a feature within some DNS servers that allows you to modify the responses given to clients depending on a number of different criteria. BIND from Internet Systems Consortium (ISC) was pretty much first to have RPZ, but others have varying levels of support for the main functionality. The BIND implementation allows you to define a policy that can consist of a number of layers. Within the policy you can override the entire contents of a layer, and within each layer you can have permit and deny actions based on a number of triggers. For this use case, we are interested in two of the triggers:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;the name being looked up&lt;&#x2F;li&gt;
&lt;li&gt;the IP of the client making the request&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;The file we download from Energized Protect will form the main blocking layer, and we’ll override the entire layer at the policy level with &lt;code&gt;NXDOMAIN&lt;&#x2F;code&gt;. Arguably we could send queries to a web server with a block page, but not all things on the requesting end of this are browsers, and we can get logging from the BIND servers if we want to know what was blocked for a given client for the purposes of troubleshooting. Of course, we will want to be able to override these entries incase something gets on the list that we don’t want to be affected by (see above).&lt;&#x2F;p&gt;
&lt;p&gt;RPZ layers are DNS zone file format (see &lt;a href=&quot;https:&#x2F;&#x2F;tools.ietf.org&#x2F;html&#x2F;rfc1035&quot;&gt;RFC1035 section 5&lt;&#x2F;a&gt; if you’re particularly interested in DNS master zone format, or for RPZ you can read the &lt;a href=&quot;https:&#x2F;&#x2F;www.ietf.org&#x2F;archive&#x2F;id&#x2F;draft-vixie-dnsop-dns-rpz-00.txt&quot;&gt;RFC draft&lt;&#x2F;a&gt; (it’s not made it to a full RFC yet…)).&lt;&#x2F;p&gt;
&lt;p&gt;Because they’re DNS zone files, they can be transferred to other DNS servers using the normal notify and transfer mechanisms.&lt;&#x2F;p&gt;
&lt;p&gt;On my network here, there’s a central authoritative server, and then a pair of recursive servers that deal with actual client requests. I’ll get around to writing about the anycast set up of those in another article.&lt;&#x2F;p&gt;
&lt;p&gt;For the purposes of this article, the authoritative master is on &lt;code&gt;192.168.1.53&lt;&#x2F;code&gt;, and the two slaves that are actually dealing with the client recursion are on &lt;code&gt;192.168.1.51&lt;&#x2F;code&gt; and &lt;code&gt;192.168.1.52&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;central-authoritative-server&quot;&gt;Central Authoritative Server&lt;&#x2F;h1&gt;
&lt;p&gt;We’ll start with the central authoritative server. There are two bits to this, periodically fetching the RPZ, and serving it to the slave servers.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;the-code&quot;&gt;The Code&lt;&#x2F;h2&gt;
&lt;p&gt;All of the scripts I talk about below, can be found in the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;karldyson&#x2F;rpz-blocking&quot;&gt;code repository&lt;&#x2F;a&gt;. The code is fairly straight foward, but of course, drop me a line if you have questions.&lt;&#x2F;p&gt;
&lt;p&gt;Energized Protect update their feeds every 6 hours, and so there’s no need to poll them any more often than that. Further, the &lt;code&gt;updateblockrpz&lt;&#x2F;code&gt; script keeps an unchanged copy of the downloaded file so that &lt;code&gt;wget&lt;&#x2F;code&gt; can do timestamping and only download the file if it has actually changed on the server.&lt;&#x2F;p&gt;
&lt;p&gt;There are two further scripts, both of which allow you to manipulate an override layer in the policy.&lt;&#x2F;p&gt;
&lt;p&gt;The first, &lt;code&gt;rpz-override&lt;&#x2F;code&gt;, allows you to add and remove domains from the override, either to add things you want to block, or allow things blocked in the block layer.&lt;&#x2F;p&gt;
&lt;p&gt;The second script, &lt;code&gt;rpz-override-client&lt;&#x2F;code&gt;, allows you to base the action on the client IP instead of on the queried name.&lt;&#x2F;p&gt;
&lt;p&gt;Both of these are written in Perl, and more specifically are built on the &lt;code&gt;Net::DNS&lt;&#x2F;code&gt; module to send the changes into the server via a dynamic update.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;the-config&quot;&gt;The Config&lt;&#x2F;h2&gt;
&lt;p&gt;Next, let’s look at how we configure the server. A base understanding of BIND configuration is assumed.&lt;&#x2F;p&gt;
&lt;p&gt;First, we’ll need to config it to master the two zones, permit dynamic updates on the override zone, and permit slaves to transfer them. Depending on your distro, the location of your &lt;code&gt;named.conf&lt;&#x2F;code&gt; may vary, and also whether it’s a single file or split out with includes. I’ll just include generic config here to try and cover as many bases as possible.&lt;&#x2F;p&gt;
&lt;pre data-linenos class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;1&lt;&#x2F;td&gt;&lt;td&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;zone &amp;quot;block&amp;quot; {
&lt;&#x2F;span&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;2&lt;&#x2F;td&gt;&lt;td&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	type master;
&lt;&#x2F;span&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;3&lt;&#x2F;td&gt;&lt;td&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	file &amp;quot;rpz&#x2F;block&amp;quot;;
&lt;&#x2F;span&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;&lt;mark&gt;4&lt;&#x2F;mark&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	notify explicit;
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;&lt;mark&gt;5&lt;&#x2F;mark&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	also-notify {
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;&lt;mark&gt;6&lt;&#x2F;mark&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;		192.168.1.51;
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;&lt;mark&gt;7&lt;&#x2F;mark&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;		192.168.1.52;
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;8&lt;&#x2F;td&gt;&lt;td&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	};
&lt;&#x2F;span&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;9&lt;&#x2F;td&gt;&lt;td&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;};
&lt;&#x2F;span&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;10&lt;&#x2F;td&gt;&lt;td&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;11&lt;&#x2F;td&gt;&lt;td&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;zone &amp;quot;override&amp;quot; {
&lt;&#x2F;span&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;12&lt;&#x2F;td&gt;&lt;td&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	type master;
&lt;&#x2F;span&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;13&lt;&#x2F;td&gt;&lt;td&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	file &amp;quot;rpz&#x2F;override&amp;quot;;
&lt;&#x2F;span&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;&lt;mark&gt;14&lt;&#x2F;mark&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	notify explicit;
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;&lt;mark&gt;15&lt;&#x2F;mark&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	also-notify {
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;&lt;mark&gt;16&lt;&#x2F;mark&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;		192.168.1.51;
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;&lt;mark&gt;17&lt;&#x2F;mark&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;		192.168.1.52;
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;18&lt;&#x2F;td&gt;&lt;td&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	};
&lt;&#x2F;span&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;&lt;mark&gt;19&lt;&#x2F;mark&gt;&lt;&#x2F;td&gt;&lt;td&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	allow-update { 127.0.0.1; ::1; };
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;tr&gt;&lt;td&gt;20&lt;&#x2F;td&gt;&lt;td&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;};
&lt;&#x2F;span&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Normal rules apply here; config like &lt;code&gt;also-notify&lt;&#x2F;code&gt; can inherit from the main options section, or can be overridden per zone like we have done here (line 4 to force just the specific entries listed in lines 5-7).&lt;&#x2F;p&gt;
&lt;p&gt;We do the same again with the override zone (lines 14 &amp;amp; 15-17), but here we also add the &lt;code&gt;allow-update&lt;&#x2F;code&gt; (line 19), in order to permit the maintenance scripts to work.&lt;&#x2F;p&gt;
&lt;p&gt;If your main &lt;code&gt;options&lt;&#x2F;code&gt; section has &lt;code&gt;allow-update&lt;&#x2F;code&gt; specified, you will need to specify &lt;code&gt;allow-update { none; };&lt;&#x2F;code&gt; in addition for the block zone, to prevent BIND from keeping journals for the zone. If you need other config that will lead to journals, such as &lt;code&gt;ixfr-from-differences&lt;&#x2F;code&gt;, for example, then the &lt;code&gt;updateblockrpz&lt;&#x2F;code&gt; script may need a tweak to freeze and thaw the block zone instead of just reloading the update.&lt;&#x2F;p&gt;
&lt;p&gt;I run the &lt;code&gt;updateblockrpz&lt;&#x2F;code&gt; script from cron at a randomly selected minute after the hour, every 6 hours and lazily capture the output to a tmp file for troubleshooting purposes. Yes, I should likely update this to log properly!&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;17 *&#x2F;6 * * * &#x2F;usr&#x2F;local&#x2F;bin&#x2F;updateblockrpz &amp;gt;&#x2F;tmp&#x2F;updateblockrpz.tmp
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h1 id=&quot;slave-servers&quot;&gt;Slave Servers&lt;&#x2F;h1&gt;
&lt;p&gt;Having got the RPZ zones set up on the master, we can turn our attention to the slaves that are actually handling the queries from the clients on the network.&lt;&#x2F;p&gt;
&lt;p&gt;First, we’ll slave the RPZ zones from the master:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;masters rpzmasters { 192.168.1.53; };
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;zone &amp;quot;block&amp;quot; {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    type slave;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    file &amp;quot;rpz&#x2F;block&amp;quot;;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    masters { rpzmasters; };
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;};
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;zone &amp;quot;override&amp;quot; {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    type slave;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    file &amp;quot;rpz&#x2F;override&amp;quot;;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    masters { rpzmasters; };
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;};
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;…and next, we’ll define the policy that’ll apply to the clients:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;options {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	response-policy {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;		zone &amp;quot;override&amp;quot; policy given;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;		zone &amp;quot;block&amp;quot; policy nxdomain;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	}
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;		break-dnssec yes
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;		qname-wait-recurse no
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;		max-policy-ttl 900
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;};
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;As we mentioned before, we’re overriding the block layer at the policy level, forcing anything in that layer to result in a &lt;mark&gt;NXDOMAIN&lt;&#x2F;mark&gt; response. The override layer is left as given so that the actions in the layer carry. The policy is evaluated top to bottom, with the first action encountered causing an exit from policy, hence the override layer, which could be whitelisting something that’s in the block layer, is listed first.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;rpz-entries&quot;&gt;RPZ Entries&lt;&#x2F;h1&gt;
&lt;p&gt;Lastly, we’ll just briefly cover different types of record that you might want to put in the override layer; the scripts will help you mostly with this, but for those that are interested, here’s a little more detail.&lt;&#x2F;p&gt;
&lt;p&gt;Broadly, as we discussed earlier, we’re interested in two main triggers; the name being looked up, and the client making the query.&lt;&#x2F;p&gt;
&lt;p&gt;Entries that affect the domain name being looked up broadly look like this:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;some.domain.name.override. 300 IN CNAME &amp;lt;action&amp;gt;.
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Where &lt;mark&gt;&amp;lt;action&amp;gt;&lt;&#x2F;mark&gt; is one of the following:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;rpz-passthru&lt;&#x2F;code&gt; (whitelist)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;rpz-drop&lt;&#x2F;code&gt; (drop the query - quite unfriendly, will cause the client to wait for a timeout)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;.&lt;&#x2F;code&gt; (a literal dot, which will cause a NXDOMAIN response)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;It’s also possible to do something like this, if you want to override to a block page or honeypot, for example:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;some.domain.name.override. 300 IN A 192.168.0.1
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;…and of course, any of those can be prefixed with *. to cause the action to apply to everything within the bailiwick of some.domain.name.&lt;&#x2F;p&gt;
&lt;p&gt;Entries that affect the client look a little different. Firstly, they’re reversed, a bit like &lt;code&gt;in-addr.arpa&lt;&#x2F;code&gt; zones but they’re prefixed by an additional item specifying the CIDR notation. So, if you want to (using the actions from above) whitelist all queries from single IP &lt;code&gt;192.168.58.3&lt;&#x2F;code&gt;, you’d do:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;32.3.58.168.192.rpz-client-ip.override. 300 IN CNAME rpz-passthru.
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;However, if you wanted to block the upper &#x2F;25, you’d do this (note use of the subnet IP, you need to specify the correct subnet boundary IP):&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;25.128.58.168.192.rpz-client-ip.override. 300 IN CNAME rpz-passthru.
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h1 id=&quot;other-trigger-types&quot;&gt;Other Trigger Types&lt;&#x2F;h1&gt;
&lt;p&gt;We’ve not talked about the other triggers, but briefly, you can also trigger actions based on:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;rpz-ip&lt;&#x2F;code&gt; - the IP addresses that are returned in the answer to a query.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;rpz-nsdname&lt;&#x2F;code&gt; - the domain name of the nameservers that are authoritative for the domain in the query.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;rpz-nsip&lt;&#x2F;code&gt; - the IP addresses of the nameservers that are authoritative for the domain in the query (ie: what the names in (2) resolve to).&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;Type 1 can lead to data exfiltration, which, if you’re blocking a domain because you want to prevent exfiltration, defeats the object.&lt;&#x2F;p&gt;
&lt;p&gt;If you put type 1 or type 3 in a layer, then if BIND reaches that layer as it works through the policy, it will do the recursion to the authority for the zone in order to work out if the trigger is a match.&lt;&#x2F;p&gt;
&lt;p&gt;If you’re worried about data exfiltration, you &lt;strong&gt;MUST&lt;&#x2F;strong&gt; put the domains you’re blocking for that purpose in a RPZ layer above the first layer that includes type 1 or type 3 entries, then BIND will execute your configured action without any recursion.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;but-what-about-dnssec&quot;&gt;…but what about DNSSEC&lt;&#x2F;h1&gt;
&lt;p&gt;If you’ve read all that, and you’re thinking to yourself “hey, but surely returning modified answers will break DNSSEC” then you’re right. Your client machine stub-resolvers will trust your DNS resolver, and so won’t notice, but if you’re pointing a validating resolver at this setup, you’ll need to make sure you keep the &lt;code&gt;break-dnssec yes;&lt;&#x2F;code&gt; option I included above. Possibly counter-intuitively, this causes your RPZ server to lie to the downstream validating resolver.&lt;&#x2F;p&gt;
&lt;p&gt;If &lt;code&gt;baddomain.com&lt;&#x2F;code&gt; is DNSSEC signed, and is on your block list, the downstream validating resolver will usually be sending queries with &lt;mark&gt;CD&lt;&#x2F;mark&gt; set instead of trusting your validation, expecting your server to send all the required DS, DNSKEY, etc. with &lt;code&gt;break-dnssec yes;&lt;&#x2F;code&gt; the RPZ server will lie; it’ll pretend &lt;code&gt;baddomain.com&lt;&#x2F;code&gt; isn’t signed and will strip all DNSSEC data in responses to the downstream resolver(s).&lt;&#x2F;p&gt;
&lt;p&gt;It’s important to note that this has an edge case. Let’s imagine you have &lt;code&gt;gooddomain.com&lt;&#x2F;code&gt;, which is signed, and is not being modified by your policy at all. Now let’s imagine you have &lt;code&gt;badthing.gooddomain.com&lt;&#x2F;code&gt; which is not at a zone split boundary, and is just a regular non-delegation entry in &lt;code&gt;gooddomain.com&lt;&#x2F;code&gt;. If you add &lt;code&gt;badthing.gooddomain.com&lt;&#x2F;code&gt; specifically to your RPZ for modification, the server can’t deal with lying about just that entry, and the downstream validator will spot the lie, returning &lt;mark&gt;SERVFAIL&lt;&#x2F;mark&gt; to its downstream client(s).&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Alexa, why are you broken...?</title>
        <published>2021-03-01T00:00:00+00:00</published>
        <updated>2021-03-01T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://karldyson.github.io/karld-blog-website/posts/alexa-why-are-you-broken/"/>
        <id>https://karldyson.github.io/karld-blog-website/posts/alexa-why-are-you-broken/</id>
        
        <content type="html" xml:base="https://karldyson.github.io/karld-blog-website/posts/alexa-why-are-you-broken/">&lt;p&gt;For a bit of context, I have an Echo Show as a bedside alarm clock, and I also have an Echo Clock paired to an Echo Dot in the kitchen, primarily to visualise timers when I’m cooking.&lt;&#x2F;p&gt;
&lt;p&gt;After a power cut late on Friday evening, the Echo Show came back on but displaying the wrong time (more or less an hour behind, but not exactly). If you asked “Alexa, what time is it?”, the correct time would be spoken, despite the wrong time still being displayed. Weird.&lt;&#x2F;p&gt;
&lt;p&gt;So, I got up, late, of course, and went to make breakfast. The Echo Clock in the kitchen is now also displaying the wrong time, but not the same wrong time that the Echo Show is displaying. Again, asking the paired Echo Dot for the time results in it speaking the correct time. Weirder and weirder.&lt;&#x2F;p&gt;
&lt;p&gt;I tried a bunch of things with the clock, reset and re-pair, checking the location and timezone settings for the devices in the app, but nothing resolved the incorrect time. I also noticed that the clock wasn’t displaying timers properly, and the Echo Dot had stopped announcing the end of timers.&lt;&#x2F;p&gt;
&lt;p&gt;I’d checked whether the Echo devices were unable to contact some central cloud service at Amazon with a quick check of twitter and some down detectors, and they didn’t seem to indicate widespread problems, and then it struck me: I wondered if my RPZ had picked up one or more entries that was causing this?&lt;&#x2F;p&gt;
&lt;p&gt;For some context at this point, I’ve been trialling the Energized Protection “Ultimate” in RPZ format. More about that soon in another post.&lt;&#x2F;p&gt;
&lt;p&gt;I got the MAC addresses for the Echo units from the Alexa app, grabbed the assigned IPs from the firewall and then looked in the RPZ logs to see if anything was being blocked for those client IPs – &lt;strong&gt;BINGO!&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;The log entries all start at the time of the power outage, and the TTL on (at least) &lt;code&gt;fireoscaptiveportal.com&lt;&#x2F;code&gt; is &lt;code&gt;60&lt;&#x2F;code&gt;, and so I wonder if the Echo devices resolve the IP and then continue to use the resolved IP, ignoring the TTL?&lt;&#x2F;p&gt;
&lt;p&gt;There were four domains continually being blocked for the two devices:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;fireoscaptiveportal.com&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;mas-sdk.amazon.com&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;prod.amazoncrl.com&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;unagi-na.amazon.com&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;I added whitelist entries to the RPZ for those, and immediatly could hear the Echo Dot in the kitchen announcing something … it was a timer from a few days before. As I stopped one, it would tell me about another, until it seemed to get very confused, resulting in a power off&#x2F;power on.&lt;&#x2F;p&gt;
&lt;p&gt;The RPZ entries I added were:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;fireoscaptiveportal.com.override. 5 IN CNAME rpz-passthru.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;*.fireoscaptiveportal.com.override. 5 IN CNAME rpz-passthru.
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Both the Echo Show and Echo Clock immediately corrected their displayed time, and timers were both displayed correctly and announced at the end correctly.&lt;&#x2F;p&gt;
&lt;p&gt;I’ve subsequently added fixed IP leases in the firewall’s DHCP config for the Echo devices, and added client-ip whitelisting for them in the RPZ.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;32.105.0.1.10.rpz-client-ip.override. 5 IN CNAME rpz-passthru.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;32.106.0.1.10.rpz-client-ip.override. 5 IN CNAME rpz-passthru.
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Automatic Key Rolls</title>
        <published>2020-11-22T00:00:00+00:00</published>
        <updated>2020-11-22T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://karldyson.github.io/karld-blog-website/posts/automatic-key-rolling/"/>
        <id>https://karldyson.github.io/karld-blog-website/posts/automatic-key-rolling/</id>
        
        <content type="html" xml:base="https://karldyson.github.io/karld-blog-website/posts/automatic-key-rolling/">&lt;p&gt;I recently moved my test domains onto a separate DNS master so that I could more freely tinker with these domains without risk to my regular stable domains.&lt;&#x2F;p&gt;
&lt;p&gt;I use catalog zones (maybe this is for another post!) to distribute the zones to save myself the bother of having to configure all the slaves, particularly since I’ve recently started spinning up an experimental anycast network of virtual machines, and so I added a second catalog to my slave servers, and away we went.&lt;&#x2F;p&gt;
&lt;p&gt;I’m a keen user of debian, and so I built the test master on ‘sid’ so I could run bleeding edge.&lt;&#x2F;p&gt;
&lt;p&gt;The benefit, primarily, was that whereas Debian 10 gets BIND 9.11.5, sid gets 9.16.8 (at the time of writing) as well as a newer version of openssl, meaning I could sign a zone with algorithm 16, ED448. DS digest algorithm 4 (SHA-384) is also supported.&lt;&#x2F;p&gt;
&lt;p&gt;The biggy for me, though, and the main driver for having the newer version of BIND, was &lt;code&gt;dnssec-policy;&lt;&#x2F;code&gt; getting BIND to automatically roll your keys.&lt;&#x2F;p&gt;
&lt;p&gt;I’m not aware of an ability in this version to support either a hook to run a script to interact with your registrar to update a DS record when your KSK rolls, nor an ability to automate CDS or CDNSKEY, but they’ll be coming at some point in the future.&lt;&#x2F;p&gt;
&lt;p&gt;I decided to test this by auto-rolling my ZSK, so, I added the following to &lt;code&gt;&#x2F;etc&#x2F;bind&#x2F;named.conf.options&lt;&#x2F;code&gt; :&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;dnssec-policy normal {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	dnskey-ttl PT1H;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	keys {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;		ksk lifetime unlimited algorithm ecdsa384;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;		zsk lifetime 90D algorithm ecdsa384;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	};
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	max-zone-ttl P1D;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	parent-ds-ttl P1D;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	parent-propagation-delay PT1H;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	parent-registration-delay P1D;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	publish-safety PT1H;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	retire-safety PT1H;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	signatures-refresh P5D;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	signatures-validity P2W;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	signatures-validity-dnskey P2W;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	zone-propagation-delay PT5M;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;};
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;You don’t need to create initial keys or anything; BIND will do all the key juggling automatically, and will store them wherever you set &lt;code&gt;key-directory&lt;&#x2F;code&gt; to in your &lt;code&gt;options&lt;&#x2F;code&gt; section.&lt;&#x2F;p&gt;
&lt;p&gt;It doesn’t matter how you add your domains; I use &lt;code&gt;rndc addzone&lt;&#x2F;code&gt; as I have scripts that automate this as well as adding the zone to the catalog (again, that’ll be in another post at some point), the key thing being you just specify the policy in the zone. I’m also using &lt;code&gt;inline-signing;&lt;&#x2F;code&gt; whether you do will depend on your setup. Here’s a sample:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;zone &amp;quot;some.zone&amp;quot; {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    type master;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    file &amp;quot;&#x2F;path&#x2F;to&#x2F;some.zone.file&amp;quot;;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    dnssec-policy &amp;quot;normal&amp;quot;;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    inline-signing yes;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;};
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;…and as if by magic, &lt;code&gt;rndc reconfig&lt;&#x2F;code&gt;, and the keyfiles are created, and the zone signed.&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>More Anycast DNS</title>
        <published>2020-11-22T00:00:00+00:00</published>
        <updated>2020-11-22T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://karldyson.github.io/karld-blog-website/posts/more-anycast-dns/"/>
        <id>https://karldyson.github.io/karld-blog-website/posts/more-anycast-dns/</id>
        
        <content type="html" xml:base="https://karldyson.github.io/karld-blog-website/posts/more-anycast-dns/">&lt;h3 id=&quot;aka-how-to-do-bgp-with-vultr-using-exabgp&quot;&gt;aka “how to do BGP with Vultr using ExaBGP”&lt;&#x2F;h3&gt;
&lt;p&gt;Having &lt;a href=&quot;https:&#x2F;&#x2F;karldyson.github.io&#x2F;karld-blog-website&#x2F;posts&#x2F;anycasting-dns&#x2F;&quot;&gt;previously written about&lt;&#x2F;a&gt; locally anycasting services within my home network, I recently decided to run an experiment anycasting a prefix on the internet.&lt;&#x2F;p&gt;
&lt;p&gt;I’ve used ExaBGP before, and so it was a no brainer to use it again.&lt;&#x2F;p&gt;
&lt;p&gt;For anycasted services, it offers a couple of benefits;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;it’s small and lightweight&lt;&#x2F;li&gt;
&lt;li&gt;it’s in many linux distros&lt;&#x2F;li&gt;
&lt;li&gt;it can easily spawn a watchdog process that you can use to control your prefix advertisements&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;I’ve been using Vultr for my authoritative DNS servers for a while, and so it was also a bit of a no brainer to use their services for this. I’m familiar with their UI, I already have an account, and even on the cheapest virtual machines, you can do BGP; you just need to send them a letter of authority (LOA) proving you own the address space you plan on advertising.&lt;&#x2F;p&gt;
&lt;p&gt;I have my own IPv6 PI address space from RIPE, courtesy of a friendly sponsoring LIR, as well as my own ASN, so I was all set.&lt;&#x2F;p&gt;
&lt;p&gt;The other nice thing about Vultr is that the BGP session is the same peer IP at the Vultr end regardless of which of their datacentres you choose to spin things up in which means your automation to configure things is easier.&lt;&#x2F;p&gt;
&lt;p&gt;Vultr insist on a BGP session password, and the first problem I ran into turns out to be related to this, and so part of the reason for writing this is to help out anyone that also runs into this problem.&lt;&#x2F;p&gt;
&lt;p&gt;I went down a bit of a rabbit hole thinking the problem was to do with multihop BGP (Vultr’s sessions are multihop) and wondered if I needed to be setting the TTL on the outbound packets. This turned out not to be the case, but I left the settings in place anyway.&lt;&#x2F;p&gt;
&lt;p&gt;Either in a template or neighbor configuration, depending on the complexity of your needs, you’re looking for  &lt;code&gt;outgoing-ttl 2;&lt;&#x2F;code&gt; and &lt;code&gt;incoming-ttl 2;&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;I installed BIRD and used one of Vultr’s canned configs for the virtual machine in question, and this worked like a charm, so this steered me in the direction of the problem being in my configuration of ExaBGP.&lt;&#x2F;p&gt;
&lt;p&gt;BIRD would have done the job, but I’d have had to write a new watchdog, and the one I have for ExaBGP is tried and tested, tweaked to my needs, and works well, so I was keen to get ExaBGP working. It’s a complete re-write from the one I talk about in the earlier blog post, so maybe I’ll write a post on that soon…&lt;&#x2F;p&gt;
&lt;p&gt;By default, ExaBGP expects &lt;code&gt;md5-password&lt;&#x2F;code&gt; to be a &lt;mark&gt;base64 encoded string&lt;&#x2F;mark&gt;, and so if what you’ve specified is just the plain text string for the session, it won’t work. If you want to specify the plain text password in this parameter, you need to set &lt;code&gt;md5-base64&lt;&#x2F;code&gt; to &lt;code&gt;false&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;I’m using ansible to automate configuration, and so the template for my &lt;code&gt;exabgp.conf&lt;&#x2F;code&gt; looks like this:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;process monitor {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    run &#x2F;usr&#x2F;local&#x2F;bin&#x2F;exabgp-healthcheck anycast;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    encoder text;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;}
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;neighbor 2001:19f0:ffff::1 {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    local-address {{ ansible_default_ipv6.address }};
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    router-id {{ router_id }};
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    local-as {{ as_number }};
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    peer-as 64515;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    hold-time 10;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    group-updates true;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    md5-password {{ md5_password }};
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    md5-base64 false;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    outgoing-ttl 2;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    incoming-ttl 2;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    capability {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;        graceful-restart 10;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    }
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    family {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;        ipv6 unicast;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    }
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    api service {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;        processes [ monitor ];
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    }
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;I don’t have any IPv4 prefixes to advertise, so you’d need to add the relevant bits to the above if you do.&lt;&#x2F;p&gt;
&lt;p&gt;I had upgraded ExaBGP to version 4 as part of a distro upgrade on my internal resolvers, and rather than update the watchdog script, I opted for reverting ExaBGP’s setting instead. So in &lt;code&gt;exabgp.env&lt;&#x2F;code&gt; I altered the &lt;code&gt;ack&lt;&#x2F;code&gt; setting to &lt;code&gt;false&lt;&#x2F;code&gt; in the &lt;code&gt;[exabgp.api]&lt;&#x2F;code&gt; section.&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Key Validation</title>
        <published>2017-04-24T00:00:00+00:00</published>
        <updated>2017-04-24T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://karldyson.github.io/karld-blog-website/posts/validation/"/>
        <id>https://karldyson.github.io/karld-blog-website/posts/validation/</id>
        
        <content type="html" xml:base="https://karldyson.github.io/karld-blog-website/posts/validation/">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;&#x2F;h1&gt;
&lt;p&gt;Following on from my post about &lt;a href=&quot;https:&#x2F;&#x2F;karldyson.github.io&#x2F;karld-blog-website&#x2F;posts&#x2F;a-new-key&#x2F;&quot;&gt;the new key being added to the zone&lt;&#x2F;a&gt;, the required 30 days have passed and if your resolver is RFC5011 compliant, it should now trust the key.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;checking&quot;&gt;Checking…&lt;&#x2F;h1&gt;
&lt;p&gt;You can check this as follows:&lt;&#x2F;p&gt;
&lt;h2 id=&quot;bind&quot;&gt;BIND&lt;&#x2F;h2&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ cat &#x2F;var&#x2F;named&#x2F;managed-keys.bind
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ORIGIN .
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$TTL 0  ; 0 seconds
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;@                       IN SOA  . . (
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                1904       ; serial
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                0          ; refresh (0 seconds)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                0          ; retry (0 seconds)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                0          ; expire (0 seconds)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                0          ; minimum (0 seconds)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                )
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                        KEYDATA 20170425142612 20170210095625 19700101000000 257 3 8 (
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                AwEAAagAIKlVZrpC6Ia7gEzahOR+9W29euxhJhVVLOyQ
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                bSEW0O8gcCjFFVQUTf6v58fLjwBd0YI0EzrAcQqBGCzh
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                &#x2F;RStIoO8g0NfnfL2MTJRkxoXbfDaUeVPQuYEhg37NZWA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                JQ9VnMVDxP&#x2F;VHL496M&#x2F;QZxkjf5&#x2F;Efucp2gaDX6RS6CXp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                oY68LsvPVjR0ZSwzz1apAzvN9dlzEheX7ICJBBtuA6G3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                LQpzW5hOA2hzCTMjJPJ8LbqF6dsV6DoBQzgul0sGIcGO
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                Yl7OyQdXfZ57relSQageu+ipAdTTJ25AsRTAoub8ONGc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                LmqrAmRLKBP1dfwhYB4N7knNnulqQxA+Uk1ihz0=
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                ) ; KSK; alg = RSASHA256; key id = 19036
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                ; next refresh: Tue, 25 Apr 2017 14:26:12 GMT
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                ; trusted since: Fri, 10 Feb 2017 09:56:25 GMT
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;2017-03-12.automated-ksk-test.research.icann.org KEYDATA 20170424152612 20170317172529 19700101000000 257 3 8 (
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                AwEAAa9qsSLDI+H0keqE3Yzdr6XuhqhBQVWw5xdgNoWL
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                hE4VxSEIBz9IuCA4w4ssSrClZ59seNc76ltDFcKJv3X9
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                jDjzRtBLjenIgV4n&#x2F;3GpKrAAnRlYbUtpBEdlk4mxoL3B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                lX8pfLg7RQfTlWaxOUga1+CChcVieFF&#x2F;si&#x2F;eePc9HpZb
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                WxHZRLCAE8dlDa0aa0tfVAZWOnaifpmbTvhDK3tdvMU0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                tfG2YfsOYcFB9z2KWmCDYwCONNKtls3p6wMwolun1h8I
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                Yo0PF98vqjAp3NVRZvKKdgyF&#x2F;bZ&#x2F;iJtAZFytXvXU6Gwa
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                5tOm1wgP6wuKupscP8KHBluZyOSKw4RMTk6YBdE=
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                ) ; KSK; alg = RSASHA256; key id = 3934
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                ; next refresh: Mon, 24 Apr 2017 15:26:12 GMT
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                ; trusted since: Fri, 17 Mar 2017 17:25:29 GMT
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                        KEYDATA 20170424152612 20170418002534 19700101000000 257 3 8 (
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                AwEAAfUtjasCuLysD4MbjG3v4Kyu0vvVJ&#x2F;0cIreP6flt
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                MeZmwQ5SRta&#x2F;mB+eFVjau+6YKra2UeTKxojBovHH2lZr
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                w7NNejL44&#x2F;Xps4gR3LSVMnCdwras+yvj4en64ghRGWYO
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                uB+Icb0AqrCUhLFWR8yx41UkfaA2vzFnM2xTx0N0+o6R
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                6UciWuwJResomQupOjNUy2ZAi81Y3pb0x3Lw4POjpcSJ
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                zrK4aZ&#x2F;5UPymplqhLEU2DsoQmyFlM5RNTt0YXR8XM4Yw
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                su&#x2F;scxg0u00IF1GC8xcyZUTMc1Rz98AY1VUo5QqUp9Vb
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                Aed5Aw1nNYfjLTj+zOykedgmjms1iNgh9EY111c=
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                ) ; KSK; alg = RSASHA256; key id = 19741
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                ; next refresh: Mon, 24 Apr 2017 15:26:12 GMT
&lt;&#x2F;span&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;                                ; trusted since: Tue, 18 Apr 2017 00:25:34 GMT
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;We can see in the output above that the new key, keytag 19741, is now trusted.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;unbound&quot;&gt;Unbound&lt;&#x2F;h2&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ cat &#x2F;var&#x2F;lib&#x2F;unbound&#x2F;2017-03-12.automated-ksk-test.research.icann.org.ds
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; autotrust trust anchor file
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;;id: 2017-03-12.automated-ksk-test.research.icann.org. 1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;;last_queried: 1493044058 ;;Mon Apr 24 14:27:38 2017
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;;last_success: 1493044058 ;;Mon Apr 24 14:27:38 2017
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;;next_probe_time: 1493047519 ;;Mon Apr 24 15:25:19 2017
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;;query_failed: 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;;query_interval: 3600
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;;retry_time: 3600
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;2017-03-12.automated-ksk-test.research.icann.org.       60      IN      DNSKEY  257 3 8 AwEAAa9qsSLDI+H0keqE3Yzdr6XuhqhBQVWw5xdgNoWLhE4VxSEIBz9IuCA4w4ssSrClZ59seNc76ltDFcKJv3X9jDjzRtBLjenIgV4n&#x2F;3GpKrAAnRlYbUtpBEdlk4mxoL3BlX8pfLg7RQfTlWaxOUga1+CChcVieFF&#x2F;si&#x2F;eePc9HpZbWxHZRLCAE8dlDa0aa0tfVAZWOnaifpmbTvhDK3tdvMU0tfG2YfsOYcFB9z2KWmCDYwCONNKtls3p6wMwolun1h8IYo0PF98vqjAp3NVRZvKKdgyF&#x2F;bZ&#x2F;iJtAZFytXvXU6Gwa5tOm1wgP6wuKupscP8KHBluZyOSKw4RMTk6YBdE= ;{id = 3934 (ksk), size = 2048b} ;;state=2 [  VALID  ] ;;count=0 ;;lastchange=1489997718 ;;Mon Mar 20 08:15:18 2017
&lt;&#x2F;span&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;2017-03-12.automated-ksk-test.research.icann.org.       60      IN      DNSKEY  257 3 8 AwEAAfUtjasCuLysD4MbjG3v4Kyu0vvVJ&#x2F;0cIreP6fltMeZmwQ5SRta&#x2F;mB+eFVjau+6YKra2UeTKxojBovHH2lZrw7NNejL44&#x2F;Xps4gR3LSVMnCdwras+yvj4en64ghRGWYOuB+Icb0AqrCUhLFWR8yx41UkfaA2vzFnM2xTx0N0+o6R6UciWuwJResomQupOjNUy2ZAi81Y3pb0x3Lw4POjpcSJzrK4aZ&#x2F;5UPymplqhLEU2DsoQmyFlM5RNTt0YXR8XM4Ywsu&#x2F;scxg0u00IF1GC8xcyZUTMc1Rz98AY1VUo5QqUp9VbAed5Aw1nNYfjLTj+zOykedgmjms1iNgh9EY111c= ;{id = 19741 (ksk), size = 2048b} ;;state=2 [  VALID  ] ;;count=0 ;;lastchange=1492590342 ;;Wed Apr 19 08:25:42 2017
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Similarly, for Unbound, we can see above that the status is now &lt;mark&gt;VALID&lt;&#x2F;mark&gt;.&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>A New Key...</title>
        <published>2017-03-21T00:00:00+00:00</published>
        <updated>2017-03-21T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://karldyson.github.io/karld-blog-website/posts/a-new-key/"/>
        <id>https://karldyson.github.io/karld-blog-website/posts/a-new-key/</id>
        
        <content type="html" xml:base="https://karldyson.github.io/karld-blog-website/posts/a-new-key/">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;&#x2F;h1&gt;
&lt;p&gt;Further to my post on &lt;a href=&quot;https:&#x2F;&#x2F;karldyson.github.io&#x2F;karld-blog-website&#x2F;posts&#x2F;rolling-rolling-rolling&#x2F;&quot;&gt;ICANN’s automated KSK testlab&lt;&#x2F;a&gt;, ICANN generated a new key on the 19th, and added it to the test zone that we’re using, and we can see it below:&lt;&#x2F;p&gt;
&lt;h1 id=&quot;the-new-key&quot;&gt;The New Key&lt;&#x2F;h1&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ dig +multiline @::1 2017-03-12.automated-ksk-test.research.icann.org dnskey
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.9.5-9+deb8u6-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; +multiline @::1 2017-03-12.automated-ksk-test.research.icann.org dnskey
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; (1 server found)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; global options: +cmd
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; Got answer:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NOERROR, id: 36605
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; flags: qr rd ra ad; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; OPT PSEUDOSECTION:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; EDNS: version: 0, flags:; udp: 4096
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; QUESTION SECTION:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;2017-03-12.automated-ksk-test.research.icann.org. IN DNSKEY
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; ANSWER SECTION:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;2017-03-12.automated-ksk-test.research.icann.org. 60 IN	DNSKEY 257 3 8 (
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				AwEAAa9qsSLDI+H0keqE3Yzdr6XuhqhBQVWw5xdgNoWL
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				hE4VxSEIBz9IuCA4w4ssSrClZ59seNc76ltDFcKJv3X9
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				jDjzRtBLjenIgV4n&#x2F;3GpKrAAnRlYbUtpBEdlk4mxoL3B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				lX8pfLg7RQfTlWaxOUga1+CChcVieFF&#x2F;si&#x2F;eePc9HpZb
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				WxHZRLCAE8dlDa0aa0tfVAZWOnaifpmbTvhDK3tdvMU0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				tfG2YfsOYcFB9z2KWmCDYwCONNKtls3p6wMwolun1h8I
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				Yo0PF98vqjAp3NVRZvKKdgyF&#x2F;bZ&#x2F;iJtAZFytXvXU6Gwa
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				5tOm1wgP6wuKupscP8KHBluZyOSKw4RMTk6YBdE=
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				) ; KSK; alg = RSASHA256; key id = 3934
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;2017-03-12.automated-ksk-test.research.icann.org. 60 IN	DNSKEY 256 3 8 (
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				AwEAAbqImB5UsfE5J&#x2F;sx3L3uQxjSY5HIPjrlTFKA+cxE
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				R8SmU1wWGo21nrNBm3pOIYoC3zhiaCq1Jo6XrTcg+In+
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				62g7PeXBO+2QBoHzCBxqbFMPoGpHph7D&#x2F;OebWOvw5Akz
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				MFqus2&#x2F;JxZtvJOgkBws1EbzOw&#x2F;lKbJUZVStUiCOZ8wFP
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				Xd3X7nQMjVTOu6Cb2uGAVrgBRsARo+2CdcXNEtzNTHU1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				c+VxH9G&#x2F;t&#x2F;2VCrueDmr&#x2F;epUP1adkyNUmXoYaG3eMrdGr
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				ml8Dr7OMrt40vlWFp6i3TxltDXG&#x2F;navXdEmL&#x2F;w6f+pA6
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				Dt9KVw&#x2F;iEUxB08+4VY6jMkxfWJAD6t5XwCVcKH8=
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				) ; ZSK; alg = RSASHA256; key id = 19401
&lt;&#x2F;span&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;2017-03-12.automated-ksk-test.research.icann.org. 60 IN	DNSKEY 257 3 8 (
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				AwEAAfUtjasCuLysD4MbjG3v4Kyu0vvVJ&#x2F;0cIreP6flt
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				MeZmwQ5SRta&#x2F;mB+eFVjau+6YKra2UeTKxojBovHH2lZr
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				w7NNejL44&#x2F;Xps4gR3LSVMnCdwras+yvj4en64ghRGWYO
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				uB+Icb0AqrCUhLFWR8yx41UkfaA2vzFnM2xTx0N0+o6R
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				6UciWuwJResomQupOjNUy2ZAi81Y3pb0x3Lw4POjpcSJ
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				zrK4aZ&#x2F;5UPymplqhLEU2DsoQmyFlM5RNTt0YXR8XM4Yw
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				su&#x2F;scxg0u00IF1GC8xcyZUTMc1Rz98AY1VUo5QqUp9Vb
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				Aed5Aw1nNYfjLTj+zOykedgmjms1iNgh9EY111c=
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				) ; KSK; alg = RSASHA256; key id = 19741
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; Query time: 285 msec
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; SERVER: ::1#53(::1)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; WHEN: Tue Mar 21 20:17:12 GMT 2017
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; MSG SIZE  rcvd: 905
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h1 id=&quot;troubleshooting&quot;&gt;Troubleshooting&lt;&#x2F;h1&gt;
&lt;p&gt;Key &lt;mark&gt;19741&lt;&#x2F;mark&gt; is a new KSK in the zone.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;bind9&quot;&gt;BIND9&lt;&#x2F;h2&gt;
&lt;p&gt;If you look in &lt;code&gt;managed-keys.bind&lt;&#x2F;code&gt; (I’m running Debian, and so that’s in &lt;code&gt;&#x2F;var&#x2F;cache&#x2F;bind&#x2F;&lt;&#x2F;code&gt;) you’ll now see the new key is visible while BIND is observing the new key. RFC5011 defines the period that the resolver must observe the new key for as either at least two times the TTL of the keyset containing the new key, or 30 days; whichever is the longer.&lt;&#x2F;p&gt;
&lt;p&gt;I’m cheating, slightly, and taking a look at &lt;code&gt;managed-keys.bind&lt;&#x2F;code&gt; from a different server, because my Debian box is running BIND 9.9.5, whereas I have access to a 9.11 box; you’ll see why below:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ cat &#x2F;var&#x2F;named&#x2F;managed-keys.bind
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ORIGIN .
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$TTL 0	; 0 seconds
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;@			IN SOA	. . (
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				284        ; serial
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				0          ; refresh (0 seconds)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				0          ; retry (0 seconds)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				0          ; expire (0 seconds)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				0          ; minimum (0 seconds)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;			KEYDATA	20170322222551 20170210095625 19700101000000 257 3 8 (
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				AwEAAagAIKlVZrpC6Ia7gEzahOR+9W29euxhJhVVLOyQ
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				bSEW0O8gcCjFFVQUTf6v58fLjwBd0YI0EzrAcQqBGCzh
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				&#x2F;RStIoO8g0NfnfL2MTJRkxoXbfDaUeVPQuYEhg37NZWA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				JQ9VnMVDxP&#x2F;VHL496M&#x2F;QZxkjf5&#x2F;Efucp2gaDX6RS6CXp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				oY68LsvPVjR0ZSwzz1apAzvN9dlzEheX7ICJBBtuA6G3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				LQpzW5hOA2hzCTMjJPJ8LbqF6dsV6DoBQzgul0sGIcGO
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				Yl7OyQdXfZ57relSQageu+ipAdTTJ25AsRTAoub8ONGc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				LmqrAmRLKBP1dfwhYB4N7knNnulqQxA+Uk1ihz0=
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				) ; KSK; alg = RSASHA256; key id = 19036
&lt;&#x2F;span&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				; next refresh: Wed, 22 Mar 2017 22:25:51 GMT
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				; trusted since: Fri, 10 Feb 2017 09:56:25 GMT
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;2017-03-12.automated-ksk-test.research.icann.org KEYDATA 20170321232551 20170317172529 19700101000000 257 3 8 (
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				AwEAAa9qsSLDI+H0keqE3Yzdr6XuhqhBQVWw5xdgNoWL
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				hE4VxSEIBz9IuCA4w4ssSrClZ59seNc76ltDFcKJv3X9
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				jDjzRtBLjenIgV4n&#x2F;3GpKrAAnRlYbUtpBEdlk4mxoL3B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				lX8pfLg7RQfTlWaxOUga1+CChcVieFF&#x2F;si&#x2F;eePc9HpZb
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				WxHZRLCAE8dlDa0aa0tfVAZWOnaifpmbTvhDK3tdvMU0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				tfG2YfsOYcFB9z2KWmCDYwCONNKtls3p6wMwolun1h8I
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				Yo0PF98vqjAp3NVRZvKKdgyF&#x2F;bZ&#x2F;iJtAZFytXvXU6Gwa
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				5tOm1wgP6wuKupscP8KHBluZyOSKw4RMTk6YBdE=
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				) ; KSK; alg = RSASHA256; key id = 3934
&lt;&#x2F;span&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				; next refresh: Tue, 21 Mar 2017 23:25:51 GMT
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				; trusted since: Fri, 17 Mar 2017 17:25:29 GMT
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;			KEYDATA	20170321232551 20170418002534 19700101000000 257 3 8 (
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				AwEAAfUtjasCuLysD4MbjG3v4Kyu0vvVJ&#x2F;0cIreP6flt
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				MeZmwQ5SRta&#x2F;mB+eFVjau+6YKra2UeTKxojBovHH2lZr
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				w7NNejL44&#x2F;Xps4gR3LSVMnCdwras+yvj4en64ghRGWYO
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				uB+Icb0AqrCUhLFWR8yx41UkfaA2vzFnM2xTx0N0+o6R
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				6UciWuwJResomQupOjNUy2ZAi81Y3pb0x3Lw4POjpcSJ
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				zrK4aZ&#x2F;5UPymplqhLEU2DsoQmyFlM5RNTt0YXR8XM4Yw
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				su&#x2F;scxg0u00IF1GC8xcyZUTMc1Rz98AY1VUo5QqUp9Vb
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				Aed5Aw1nNYfjLTj+zOykedgmjms1iNgh9EY111c=
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				) ; KSK; alg = RSASHA256; key id = 19741
&lt;&#x2F;span&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				; next refresh: Tue, 21 Mar 2017 23:25:51 GMT
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;				; trust pending: Tue, 18 Apr 2017 00:25:34 GMT
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;On my 9.9.5 server, I don’t have the helpful comments. We can see, helpfully, that the root key (19036), and our original testlab key (3934) are trusted. We can also see that the server observing key 19741 because the instead of trusted since we can see trust pending.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;unbound&quot;&gt;Unbound&lt;&#x2F;h2&gt;
&lt;p&gt;If you remember from the original post, whereas BIND keeps a track in &lt;code&gt;managed-keys.bind&lt;&#x2F;code&gt;, Unbound tracks the metadata in the external file we specified with &lt;code&gt;auto-trust-anchor-file:&lt;&#x2F;code&gt;. The file has been updated in a similar way to BIND’s:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ cat &#x2F;var&#x2F;lib&#x2F;unbound&#x2F;2017-03-12.automated-ksk-test.research.icann.org.ds
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; autotrust trust anchor file
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;;id: 2017-03-12.automated-ksk-test.research.icann.org. 1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;;last_queried: 1490135144 ;;Tue Mar 21 22:25:44 2017
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;;last_success: 1490135144 ;;Tue Mar 21 22:25:44 2017
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;;next_probe_time: 1490138421 ;;Tue Mar 21 23:20:21 2017
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;;query_failed: 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;;query_interval: 3600
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;;retry_time: 3600
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;2017-03-12.automated-ksk-test.research.icann.org.	60	IN	DNSKEY	257 3 8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;AwEAAa9qsSLDI+H0keqE3Yzdr6XuhqhBQVWw5xdgNoWLhE4VxSEIBz9IuCA4w4ssSrClZ59seNc76ltDFcKJv3X
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;9jDjzRtBLjenIgV4n&#x2F;3GpKrAAnRlYbUtpBEdlk4mxoL3BlX8pfLg7RQfTlWaxOUga1+CChcVieFF&#x2F;si&#x2F;eePc9Hp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;ZbWxHZRLCAE8dlDa0aa0tfVAZWOnaifpmbTvhDK3tdvMU0tfG2YfsOYcFB9z2KWmCDYwCONNKtls3p6wMwolun1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;h8IYo0PF98vqjAp3NVRZvKKdgyF&#x2F;bZ&#x2F;iJtAZFytXvXU6Gwa5tOm1wgP6wuKupscP8KHBluZyOSKw4RMTk6YBdE=
&lt;&#x2F;span&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;{id = 3934 (ksk), size = 2048b} ;;state=2 [  VALID  ] ;;count=0 ;;lastchange=1489997718 ;;Mon Mar 20 08:15:18 2017
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;2017-03-12.automated-ksk-test.research.icann.org.	60	IN	DNSKEY	257 3 8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;AwEAAfUtjasCuLysD4MbjG3v4Kyu0vvVJ&#x2F;0cIreP6fltMeZmwQ5SRta&#x2F;mB+eFVjau+6YKra2UeTKxojBovHH2lZ
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;rw7NNejL44&#x2F;Xps4gR3LSVMnCdwras+yvj4en64ghRGWYOuB+Icb0AqrCUhLFWR8yx41UkfaA2vzFnM2xTx0N0+o
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;6R6UciWuwJResomQupOjNUy2ZAi81Y3pb0x3Lw4POjpcSJzrK4aZ&#x2F;5UPymplqhLEU2DsoQmyFlM5RNTt0YXR8XM
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;4Ywsu&#x2F;scxg0u00IF1GC8xcyZUTMc1Rz98AY1VUo5QqUp9VbAed5Aw1nNYfjLTj+zOykedgmjms1iNgh9EY111c=
&lt;&#x2F;span&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;{id = 19741 (ksk), size = 2048b} ;;state=1 [ ADDPEND ] ;;count=34 ;;lastchange=1489997718 ;;Mon Mar 20 08:15:18 2017
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;In line 15, we see the original key (3934) with a status of &lt;mark&gt;VALID&lt;&#x2F;mark&gt;, whereas in line 22 we see the newly spotted key 19741 is &lt;mark&gt;ADDPEND&lt;&#x2F;mark&gt;.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;what-s-next&quot;&gt;What’s next…?&lt;&#x2F;h1&gt;
&lt;p&gt;Now we wait; 30 days, and as long as the key is observed throughout, the key should become trusted at the end of this…&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Rolling, Rolling, Rolling...</title>
        <published>2017-03-17T00:00:00+00:00</published>
        <updated>2017-03-17T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://karldyson.github.io/karld-blog-website/posts/rolling-rolling-rolling/"/>
        <id>https://karldyson.github.io/karld-blog-website/posts/rolling-rolling-rolling/</id>
        
        <content type="html" xml:base="https://karldyson.github.io/karld-blog-website/posts/rolling-rolling-rolling/">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;&#x2F;h1&gt;
&lt;p&gt;In October 2017, ICANN are going to roll the key signing key in the root of the DNS.&lt;&#x2F;p&gt;
&lt;p&gt;If you’re not technical and don’t know what I just said, this post isn’t for you.&lt;&#x2F;p&gt;
&lt;p&gt;If, however, you run a validating recursive resolver, read on…&lt;&#x2F;p&gt;
&lt;p&gt;In October (the 11th to be exact), the key will roll and you’ll need to have done one of two things…&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Update your root trust anchor manually&lt;&#x2F;li&gt;
&lt;li&gt;Check your resolver is RFC5011 compliant.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;But first, a little…&lt;&#x2F;p&gt;
&lt;h1 id=&quot;background&quot;&gt;Background…&lt;&#x2F;h1&gt;
&lt;p&gt;So you know how DNSSEC works…&lt;&#x2F;p&gt;
&lt;p&gt;…you sign a zone. More specifically, you generate two keys, a key to sign the zone (ZSK), and a key to sign the keys (KSK). The zone gets bigger because for each record set, a signature is generated and added (RRSIG records). The public part of the keyset is also added to the zone (DNSKEY records). Some form of proof of non-existance is added (NSEC or NSEC3).&lt;&#x2F;p&gt;
&lt;p&gt;Next, once the keys and signatures have made it to all of the nameservers for the zone, you generate a delegated signer record (DS) from the KSK, and you publish that in the parent. The parent then signs the DS record, and hey presto, your chain of trust is made.&lt;&#x2F;p&gt;
&lt;p&gt;So, where’s the DS record for the root…?&lt;&#x2F;p&gt;
&lt;p&gt;To make this chain of trust work, resolvers that want to validate the DNSSEC chain of trust need a starting point in the root…&lt;&#x2F;p&gt;
&lt;p&gt;Your resolver has a trust anchor for the root. Depending on what you’re using for a resolver, this will either be the DS of the root KSK, or the public part of the KSK.&lt;&#x2F;p&gt;
&lt;p&gt;Your resolver will have this built in, but then, if configured correctly, will use an automatic mechanism to keep that key up to date and roll it when required.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;rfc5011&quot;&gt;RFC5011&lt;&#x2F;h1&gt;
&lt;p&gt;RFC5011 defines how a resolver can automatically update a trust anchor for a zone.&lt;&#x2F;p&gt;
&lt;p&gt;So that you can check whether your resolver will follow this process, ICANN have an automated testbed for the KSK roll, which I encourage you to look at.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;icann-s-automated-test&quot;&gt;ICANN’s Automated Test&lt;&#x2F;h1&gt;
&lt;p&gt;Each week, they create a new zone, and they sign it with a set of newly generated keys. Purposefully broken DS records are published in the parent zone, so that a normal validating resolver will SERVFAIL (because validation fails).&lt;&#x2F;p&gt;
&lt;p&gt;By adding a trust anchor to your resolver, the zone will validate.&lt;&#x2F;p&gt;
&lt;p&gt;If correctly configured, your resolver will now look for new key signing keys, and will observe them, and use them as per RFC5011.&lt;&#x2F;p&gt;
&lt;p&gt;So, lets take a look at this. Before I add a trust anchor, I can check that the zone doesn’t validate:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ dig @::1 2017-03-12.automated-ksk-test.research.icann.org soa
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.9.5-9+deb8u6-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; @::1 2017-03-12.automated-ksk-test.research.icann.org soa
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; (1 server found)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; global options: +cmd
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; Got answer:
&lt;&#x2F;span&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: SERVFAIL, id: 39100
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; OPT PSEUDOSECTION:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; EDNS: version: 0, flags:; udp: 4096
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; QUESTION SECTION:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;2017-03-12.automated-ksk-test.research.icann.org. IN SOA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; Query time: 1908 msec
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; SERVER: ::1#53(::1)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; WHEN: Mon Mar 20 13:22:57 GMT 2017
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; MSG SIZE  rcvd: 77
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;We can see in line 7, that we have a &lt;mark&gt;SERVFAIL&lt;&#x2F;mark&gt; response.&lt;&#x2F;p&gt;
&lt;p&gt;This server is running BIND. So, first we check that the server is configured manage keys using RFC5011:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;options {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    ...
&lt;&#x2F;span&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    dnssec-validation auto;
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    ...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;};
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;If you’re just adding this, don’t forget to &lt;code&gt;rndc reconfig&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;trust-anchor&quot;&gt;Trust Anchor&lt;&#x2F;h1&gt;
&lt;p&gt;Now, we need to add a trust anchor:&lt;&#x2F;p&gt;
&lt;h1 id=&quot;bind&quot;&gt;BIND&lt;&#x2F;h1&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;managed-keys {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  2017-03-12.automated-ksk-test.research.icann.org initial-key 257 3 8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  &amp;quot;AwEAAa9qsSLDI+H0keqE3Yzdr6XuhqhBQVWw5xdgNoWLhE4VxSEIBz9I
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  uCA4w4ssSrClZ59seNc76ltDFcKJv3X9jDjzRtBLjenIgV4n&#x2F;3GpKrAA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  nRlYbUtpBEdlk4mxoL3BlX8pfLg7RQfTlWaxOUga1+CChcVieFF&#x2F;si&#x2F;e
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  ePc9HpZbWxHZRLCAE8dlDa0aa0tfVAZWOnaifpmbTvhDK3tdvMU0tfG2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  YfsOYcFB9z2KWmCDYwCONNKtls3p6wMwolun1h8IYo0PF98vqjAp3NVR
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  ZvKKdgyF&#x2F;bZ&#x2F;iJtAZFytXvXU6Gwa5tOm1wgP6wuKupscP8KHBluZyOSK
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  w4RMTk6YBdE=&amp;quot;;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;};
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This is added in your &lt;code&gt;named.conf&lt;&#x2F;code&gt; file.&lt;&#x2F;p&gt;
&lt;p&gt;Once again, don’t forget to &lt;code&gt;rndc reconfig&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;unbound&quot;&gt;Unbound&lt;&#x2F;h1&gt;
&lt;p&gt;If you’re running Unbound, then you can add the DNSKEY or DS records to a file in a location that Unbound can read and write to (so, somewhere like &lt;code&gt;&#x2F;var&#x2F;lib&#x2F;unbound&#x2F;&lt;&#x2F;code&gt; and then add a &lt;code&gt;auto-trust-anchor-file&lt;&#x2F;code&gt; line in the &lt;code&gt;server:&lt;&#x2F;code&gt; section of your &lt;code&gt;unbound.conf&lt;&#x2F;code&gt; file.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cat &#x2F;var&#x2F;lib&#x2F;unbound&#x2F;2017-03-12.automated-ksk-test.research.icann.org.ds
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;2017-03-12.automated-ksk-test.research.icann.org. IN DS 3934 8 1 47AA8AAF4D75B3D9C58448F241F793EBC4977821
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;2017-03-12.automated-ksk-test.research.icann.org. IN DS 3934 8 2 0D27F2E6EA9CA548F1896A71FB07CED86074D3462F2A720D6177F3C5CEC15F0D
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Note; the file doesn’t look like this once you’ve told Unbound about it, as it uses the file to store metadata related to the RFC5011 process.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;server:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    ...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    auto-trust-anchor-file: &amp;quot;&#x2F;var&#x2F;lib&#x2F;unbound&#x2F;2017-03-12.automated-ksk-test.research.icann.org.ds&amp;quot;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    ...
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;After adding those, you’ll want to &lt;code&gt;unbound-control reload&lt;&#x2F;code&gt; to pick up the changes.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;testing&quot;&gt;Testing&lt;&#x2F;h1&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ dig @::1 2017-03-12.automated-ksk-test.research.icann.org soa
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.9.5-9+deb8u6-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; @::1 2017-03-12.automated-ksk-test.research.icann.org soa
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; (1 server found)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; global options: +cmd
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; Got answer:
&lt;&#x2F;span&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NOERROR, id: 30413
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; flags: qr rd ra ad; QUERY: 1, ANSWER: 1, AUTHORITY: 2, ADDITIONAL: 3
&lt;&#x2F;span&gt;&lt;&#x2F;mark&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; OPT PSEUDOSECTION:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;; EDNS: version: 0, flags:; udp: 4096
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; QUESTION SECTION:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;2017-03-12.automated-ksk-test.research.icann.org. IN SOA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; ANSWER SECTION:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;2017-03-12.automated-ksk-test.research.icann.org. 60 IN	SOA ns1.research.icann.org. automated-ksk-test.research.icann.org. 1489968062 3600 600 86400 60
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; AUTHORITY SECTION:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;2017-03-12.automated-ksk-test.research.icann.org. 60 IN	NS ns2.research.icann.org.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;2017-03-12.automated-ksk-test.research.icann.org. 60 IN	NS ns1.research.icann.org.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; ADDITIONAL SECTION:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;ns1.research.icann.org.	3600	IN	A	192.0.34.56
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;ns2.research.icann.org.	3600	IN	A	192.0.45.56
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; Query time: 428 msec
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; SERVER: ::1#53(::1)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; WHEN: Mon Mar 20 13:44:24 GMT 2017
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;;; MSG SIZE  rcvd: 181
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This time, we can see that on line 7, we have a &lt;mark&gt;NOERROR&lt;&#x2F;mark&gt; response, and on line 8, we can see that we have &lt;mark&gt;ad&lt;&#x2F;mark&gt; in the &lt;code&gt;flags&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;what-s-next&quot;&gt;What’s next…&lt;&#x2F;h1&gt;
&lt;p&gt;Now, we wait. The next step is that ICANN’s automated test lab will generate and publish a new KSK into the zone on the 19th.&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Anycasting DNS</title>
        <published>2015-01-18T00:00:00+00:00</published>
        <updated>2015-01-18T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://karldyson.github.io/karld-blog-website/posts/anycasting-dns/"/>
        <id>https://karldyson.github.io/karld-blog-website/posts/anycasting-dns/</id>
        
        <content type="html" xml:base="https://karldyson.github.io/karld-blog-website/posts/anycasting-dns/">&lt;h1 id=&quot;introduction&quot;&gt;Introduction…&lt;&#x2F;h1&gt;
&lt;p&gt;I wanted to have a tinker with anycasting, and DNS seemed a sensible place to start, and easy to test and muck about with. So, I spun up a couple of DNS resolvers, and decided what my anycasted IP addresses would be. They need to be outside of the subnets I’m using on the rest of my network, as I want to route traffic to them. I’ve put the underlying machine’s unicast addresses in this subnet too, but you wouldn’t have to, depending on your set up.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;servers&quot;&gt;Servers…&lt;&#x2F;h1&gt;
&lt;p&gt;The nameservers are, essentially, identical to servers that’d deal with unicast traffic, except for the following changes. I’m using BIND, but it really doesn’t matter what you use.&lt;&#x2F;p&gt;
&lt;p&gt;We need to bind up the anycast addresses so that the O&#x2F;S will deal with their traffic…&lt;&#x2F;p&gt;
&lt;p&gt;In my case, my anycasted addresses will be &lt;code&gt;10.1.53.1&lt;&#x2F;code&gt; and &lt;code&gt;10.1.53.2&lt;&#x2F;code&gt;, and I’m using Debian, so my additions to &lt;code&gt;&#x2F;etc&#x2F;network&#x2F;interfaces&lt;&#x2F;code&gt; are:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;auto lo:1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;iface lo:1 inet static
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;address 10.1.53.1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;netmask 255.255.255.255
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;auto lo:2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;iface lo:2 inet static
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;address 10.1.53.2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;netmask 255.255.255.255
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;We need to stop the machine responding to ARP for these. Actually, we tell it to stop responding to ARP requests unless the interface the ARP arrives on matches the ARP’d for IP, so because we’ve bound them up to the loopback, we don’t want the machine to respond via &lt;code&gt;eth0&lt;&#x2F;code&gt;, for example, so I added the following to &lt;code&gt;&#x2F;etc&#x2F;sysctl.conf&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;net.ipv4.conf.eth0.arp_ignore = 1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;net.ipv4.conf.eth0.arp_announce = 2
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h1 id=&quot;bgp-load-balancing&quot;&gt;BGP &amp;amp; Load Balancing…&lt;&#x2F;h1&gt;
&lt;p&gt;Now we need to advertise the anycast addresses to our router. In this case, we’ll use BGP to do this. To do that, we’ll use ExaBGP. Grab that and install it on the server, and then the config looks something like this. My router is &lt;code&gt;10.1.53.254&lt;&#x2F;code&gt;, and my two nameservers live in &lt;code&gt;10.1.53.0&#x2F;24&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;neighbor 10.1.53.254 {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  router-id 10.1.53.11;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  local-address 10.1.53.11;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  local-as 64601;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  peer-as 64601;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  hold-time 10;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  process watch-nameserver {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    run &#x2F;usr&#x2F;local&#x2F;bin&#x2F;nameserver_watchdog;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  }
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  static {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    route 10.1.53.1&#x2F;32 next-hop 10.1.53.11 watchdog anycastdns withdraw;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    route 10.1.53.2&#x2F;32 next-hop 10.1.53.11 watchdog anycastdns withdraw;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    route xxxx.xxxx.xxxx:53::1&#x2F;128 next-hop xxxx.xxxx.xxxx:53::11 watchdog anycastdns withdraw;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    route xxxx.xxxx.xxxx:53::2&#x2F;128 next-hop xxxx.xxxx.xxxx:53::11 watchdog anycastdns withdraw;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  }
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;I withdraw the routes from the outset, so that the watchdog will announce them upon successful testing.&lt;&#x2F;p&gt;
&lt;p&gt;The router’s BGP config looks like this (it’s JunOS):&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;Junos&quot; class=&quot;language-Junos z-code&quot;&gt;&lt;code class=&quot;language-Junos&quot; data-lang=&quot;Junos&quot;&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-junos&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-junos&quot;&gt;#&lt;&#x2F;span&gt; show protocols bgp group dns-anycast
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;local-address &lt;span class=&quot;z-constant z-numeric z-integer z-long z-octal z-junos&quot;&gt;10.1.53.254&lt;&#x2F;span&gt;;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;hold-time &lt;span class=&quot;z-constant z-numeric z-integer z-long z-octal z-junos&quot;&gt;10&lt;&#x2F;span&gt;;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;family inet {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;    unicast;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;}
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;family inet6 {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;    unicast;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;}
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;peer-as &lt;span class=&quot;z-constant z-numeric z-integer z-long z-octal z-junos&quot;&gt;64601&lt;&#x2F;span&gt;;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;local-as &lt;span class=&quot;z-constant z-numeric z-integer z-long z-octal z-junos&quot;&gt;64601&lt;&#x2F;span&gt;;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;multipath;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;neighbor &lt;span class=&quot;z-constant z-numeric z-integer z-long z-octal z-junos&quot;&gt;10.1.53.11&lt;&#x2F;span&gt;;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;neighbor &lt;span class=&quot;z-constant z-numeric z-integer z-long z-octal z-junos&quot;&gt;10.1.53.12&lt;&#x2F;span&gt;;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;I’m going to equally load balance between the two servers, but you could set a localpref on each server, for example, and have server1 handle .1 primarily with server2 taking over in the event of failure, and vice versa.&lt;&#x2F;p&gt;
&lt;p&gt;Don’t fall for JunOS’ misleading ‘per packet’ configuration item; this will, despite appearances, load balance per flow based on a hashing algorithm.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;Junos&quot; class=&quot;language-Junos z-code&quot;&gt;&lt;code class=&quot;language-Junos&quot; data-lang=&quot;Junos&quot;&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-junos&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-junos&quot;&gt;#&lt;&#x2F;span&gt; show routing-options forwarding-table
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;export dns-anycast-loadbalance;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-junos&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-junos&quot;&gt;#&lt;&#x2F;span&gt; show policy-options policy-statement dns-anycast-loadbalance
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;then {
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;    load-balance per-packet;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-junos&quot;&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h1 id=&quot;monitoring-and-health&quot;&gt;Monitoring and Health…&lt;&#x2F;h1&gt;
&lt;p&gt;We’ve included a watchdog in the ExaBGP config. Without this, clearly if the nameserver fails entirely, then the BGP session will be torn down, and the traffic directed to the other host. However, if the nameserver daemon fails, then the BGP session will remain, and traffic will be disrupted. Therefore, there’s a watchdog that’ll check that the nameserver daemon is listening, and will perform a lookup against it, announcing the anycast address(es) while it’s up, and withdrawing them in the event of failure. The watchdog looks like this:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;perl&quot; class=&quot;language-perl z-code&quot;&gt;&lt;code class=&quot;language-perl&quot; data-lang=&quot;perl&quot;&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-meta z-comment z-perl&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-perl&quot;&gt;#&lt;&#x2F;span&gt;!&#x2F;usr&#x2F;bin&#x2F;perl
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-use z-perl&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-use z-perl&quot;&gt;use&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-namespace z-perl&quot;&gt;strict&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-storage z-type z-variable z-perl&quot;&gt;my&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;debug&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-perl&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-keyword z-control z-conditional z-unless z-perl&quot;&gt;unless&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;debug&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-block z-begin z-perl&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-variable z-language z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;SIG&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-item-access z-begin z-perl&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;INT&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-item-access z-end z-perl&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function z-perl&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-perl&quot;&gt;&lt;span class=&quot;z-keyword z-declaration z-function z-perl&quot;&gt;sub&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-perl&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-perl&quot;&gt;}&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-perl&quot;&gt;}&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;select&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-language z-filehandle z-perl&quot;&gt;STDOUT&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-variable z-language z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;|&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-perl&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-use z-perl&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-use z-perl&quot;&gt;use&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-perl&quot;&gt;&lt;span class=&quot;z-entity z-name z-namespace z-perl&quot;&gt;IO&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-double-colon z-perl&quot;&gt;::&lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-namespace z-perl&quot;&gt;Socket&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-use z-perl&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-use z-perl&quot;&gt;use&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-perl&quot;&gt;&lt;span class=&quot;z-entity z-name z-namespace z-perl&quot;&gt;Net&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-double-colon z-perl&quot;&gt;::&lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-namespace z-perl&quot;&gt;DNS&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-storage z-type z-variable z-perl&quot;&gt;my&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;state&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;init&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-storage z-type z-variable z-perl&quot;&gt;my&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;ip&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-storage z-type z-variable z-perl&quot;&gt;my&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;domain&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-keyword z-control z-conditional z-if z-perl&quot;&gt;if&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;open&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-perl&quot;&gt;C&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-perl&quot;&gt;,&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&#x2F;etc&#x2F;nameserver_watchdog.conf&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-block z-begin z-perl&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;chomp&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;ip&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-perl&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;domain&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;split&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-generic z-begin z-perl&quot;&gt;&#x2F;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-regexp z-perl&quot;&gt;&lt;span class=&quot;z-source z-regexp&quot;&gt;&lt;span class=&quot;z-meta z-literal z-regexp&quot;&gt;:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-generic z-end z-perl&quot;&gt;&#x2F;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-perl&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-angle z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;C&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;close&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-variable z-function z-perl&quot;&gt;C&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-perl&quot;&gt;}&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-conditional z-else z-perl&quot;&gt;else&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-block z-begin z-perl&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;ip&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;127.0.0.1&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;domain&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;localdomain&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-perl&quot;&gt;}&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;checking &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-interpolation z-perl&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;ip&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt; for &lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-interpolation z-perl&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;domain&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-perl&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-conditional z-if z-perl&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;debug&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-keyword z-control z-loop z-while z-perl&quot;&gt;while&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-perl&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-block z-begin z-perl&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;eval&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-block z-begin z-perl&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;		&lt;span class=&quot;z-storage z-type z-variable z-perl&quot;&gt;local&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-language z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;SIG&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-item-access z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-item-access z-begin z-perl&quot;&gt;{&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-key z-perl&quot;&gt;ALRM&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-item-access z-end z-perl&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function z-perl&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-perl&quot;&gt;&lt;span class=&quot;z-keyword z-declaration z-function z-perl&quot;&gt;sub&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-perl&quot;&gt;{&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-flow z-die z-perl&quot;&gt;die&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;Timed Out&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-block z-end z-perl&quot;&gt;}&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;		&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;alarm&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-perl&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;		&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;attempting connect... state is [&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-interpolation z-perl&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;state&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt;]&lt;span class=&quot;z-constant z-character z-escape z-perl&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-conditional z-if z-perl&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;debug&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;		&lt;span class=&quot;z-storage z-type z-variable z-perl&quot;&gt;my&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;socket&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-perl&quot;&gt;&lt;span class=&quot;z-variable z-namespace z-perl&quot;&gt;IO&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-double-colon z-perl&quot;&gt;::&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-namespace z-perl&quot;&gt;Socket&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-double-colon z-perl&quot;&gt;::&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-namespace z-perl&quot;&gt;INET&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-arrow z-perl&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-variable z-function z-member z-perl&quot;&gt;new&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-other z-key z-perl&quot;&gt;Proto&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-key-value z-perl&quot;&gt;=&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;tcp&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-perl&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-other z-key z-perl&quot;&gt;PeerAddr&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-key-value z-perl&quot;&gt;=&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;ip&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-perl&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-other z-key z-perl&quot;&gt;PeerPort&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-key-value z-perl&quot;&gt;=&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-perl&quot;&gt;53&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-perl&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-other z-key z-perl&quot;&gt;Timeout&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-key-value z-perl&quot;&gt;=&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-perl&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;		&lt;span class=&quot;z-keyword z-control z-conditional z-if z-perl&quot;&gt;if&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;socket&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-perl&quot;&gt;&amp;amp;&amp;amp;&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;socket&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-arrow z-perl&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-variable z-function z-member z-perl&quot;&gt;connected&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-perl&quot;&gt;&amp;amp;&amp;amp;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-variable z-function z-perl&quot;&gt;do_lookup&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;ip&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-perl&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;domain&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-block z-begin z-perl&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;			&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;announce watchdog anycastdns&lt;span class=&quot;z-constant z-character z-escape z-perl&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-conditional z-if z-perl&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;state&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-perl&quot;&gt;ne&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;up&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;			&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;socket&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-arrow z-perl&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-variable z-function z-member z-perl&quot;&gt;close&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;			&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;alarm&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-perl&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;			&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;state&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;up&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;			&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;state set to up&lt;span class=&quot;z-constant z-character z-escape z-perl&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-conditional z-if z-perl&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;debug&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;		&lt;span class=&quot;z-punctuation z-section z-block z-end z-perl&quot;&gt;}&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-conditional z-else z-perl&quot;&gt;else&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-block z-begin z-perl&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;			&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;withdraw watchdog anycastdns&lt;span class=&quot;z-constant z-character z-escape z-perl&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-conditional z-if z-perl&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;state&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-perl&quot;&gt;ne&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;down&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;			&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;state&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;down&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;			&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;state set to down&lt;span class=&quot;z-constant z-character z-escape z-perl&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-conditional z-if z-perl&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;debug&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;		&lt;span class=&quot;z-punctuation z-section z-block z-end z-perl&quot;&gt;}&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-punctuation z-section z-block z-end z-perl&quot;&gt;}&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-keyword z-control z-conditional z-if z-perl&quot;&gt;if&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-language z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;@&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-block z-begin z-perl&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;		&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;state is [&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-interpolation z-perl&quot;&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;state&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt;]&lt;span class=&quot;z-constant z-character z-escape z-perl&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-conditional z-if z-perl&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;debug&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;		&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;withdraw watchdog anycastdns&lt;span class=&quot;z-constant z-character z-escape z-perl&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-conditional z-if z-perl&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;state&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-perl&quot;&gt;ne&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;down&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;		&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;state&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;down&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;		&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;state set to down in barf&lt;span class=&quot;z-constant z-character z-escape z-perl&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-conditional z-if z-perl&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;debug&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-punctuation z-section z-block z-end z-perl&quot;&gt;}&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;alarm&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-perl&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;sleep&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-perl&quot;&gt;10&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-perl&quot;&gt;}&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-meta z-function z-perl&quot;&gt;&lt;span class=&quot;z-storage z-type z-function z-perl&quot;&gt;&lt;span class=&quot;z-keyword z-declaration z-function z-perl&quot;&gt;sub&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-function z-perl&quot;&gt;do_lookup&lt;&#x2F;span&gt; &lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-perl&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-storage z-type z-variable z-perl&quot;&gt;my&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;ip&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;shift&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-storage z-type z-variable z-perl&quot;&gt;my&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;domain&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;shift&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-storage z-type z-variable z-perl&quot;&gt;my&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;r&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-perl&quot;&gt;&lt;span class=&quot;z-variable z-namespace z-perl&quot;&gt;Net&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-double-colon z-perl&quot;&gt;::&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-namespace z-perl&quot;&gt;DNS&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-double-colon z-perl&quot;&gt;::&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-namespace z-perl&quot;&gt;Resolver&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-arrow z-perl&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-variable z-function z-member z-perl&quot;&gt;new&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;r&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-arrow z-perl&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-variable z-function z-member z-perl&quot;&gt;nameservers&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;ip&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;r&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-arrow z-perl&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-variable z-function z-member z-perl&quot;&gt;tcp_timeout&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-perl&quot;&gt;5&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;r&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-arrow z-perl&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-variable z-function z-member z-perl&quot;&gt;udp_timeout&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-perl&quot;&gt;5&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-storage z-type z-variable z-perl&quot;&gt;my&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;q&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;r&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-arrow z-perl&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-variable z-function z-member z-perl&quot;&gt;query&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;domain&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-sequence z-perl&quot;&gt;,&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-single z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;SOA&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-storage z-type z-variable z-perl&quot;&gt;my&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;found&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-perl&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-perl&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;Answer: &lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-concat z-perl&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;q&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-arrow z-perl&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-variable z-function z-member z-perl&quot;&gt;answer&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-perl&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-perl&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-perl&quot;&gt;]&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-arrow z-perl&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-variable z-function z-member z-perl&quot;&gt;serial&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-concat z-perl&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-perl&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-conditional z-if z-perl&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;debug&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;found&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-perl&quot;&gt;++&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-conditional z-if z-perl&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;q&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-arrow z-perl&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-variable z-function z-member z-perl&quot;&gt;answer&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-perl&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-perl&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-perl&quot;&gt;]&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-arrow z-perl&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-variable z-function z-member z-perl&quot;&gt;serial&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-binary z-perl&quot;&gt;=~&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;m&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-generic z-begin z-perl&quot;&gt;&#x2F;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-regexp z-perl&quot;&gt;&lt;span class=&quot;z-source z-regexp&quot;&gt;&lt;span class=&quot;z-keyword z-control z-anchors z-regexp&quot;&gt;^&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-control z-character-class z-regexp&quot;&gt;\d&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-quantifier z-regexp&quot;&gt;+&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-control z-anchors z-regexp&quot;&gt;$&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-generic z-end z-perl&quot;&gt;&#x2F;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-keyword z-control z-conditional z-if z-perl&quot;&gt;if&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;debug&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-comparison z-perl&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-perl&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt; &lt;span class=&quot;z-punctuation z-section z-block z-begin z-perl&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;		&lt;span class=&quot;z-meta z-preprocessor z-require z-perl&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-require z-perl&quot;&gt;require&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-perl&quot;&gt;&lt;span class=&quot;z-entity z-name z-namespace z-perl&quot;&gt;Data&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-double-colon z-perl&quot;&gt;::&lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-namespace z-perl&quot;&gt;Dumper&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;		&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-path z-perl&quot;&gt;&lt;span class=&quot;z-variable z-namespace z-perl&quot;&gt;Data&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-double-colon z-perl&quot;&gt;::&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-namespace z-perl&quot;&gt;Dumper&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-double-colon z-perl&quot;&gt;::&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-variable z-function z-perl&quot;&gt;Dumper&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-perl&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;q&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-perl&quot;&gt;)&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-concat z-perl&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-perl&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-perl&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-punctuation z-section z-block z-end z-perl&quot;&gt;}&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-keyword z-control z-flow z-return z-perl&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-perl&quot;&gt;1&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-conditional z-if z-perl&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;q&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-logical z-perl&quot;&gt;&amp;amp;&amp;amp;&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;found&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;Error:&lt;span class=&quot;z-constant z-character z-escape z-perl&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-conditional z-if z-perl&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;debug&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;r&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-arrow z-perl&quot;&gt;-&amp;gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-variable z-function z-member z-perl&quot;&gt;errorstring&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-conditional z-if z-perl&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;debug&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-meta z-function-call z-perl&quot;&gt;&lt;span class=&quot;z-support z-function z-perl&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-string z-perl&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-perl&quot;&gt;\n&lt;&#x2F;span&gt;===&lt;span class=&quot;z-constant z-character z-escape z-perl&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-perl&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-conditional z-if z-perl&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-other z-readwrite z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-variable z-perl&quot;&gt;$&lt;&#x2F;span&gt;debug&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;	&lt;span class=&quot;z-keyword z-control z-flow z-return z-perl&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-perl&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-perl&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-perl&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-perl&quot;&gt;}&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;code&gt;&#x2F;etc&#x2F;nameserver_watchdog.conf&lt;&#x2F;code&gt; contains lines of the format &lt;code&gt;ip.ad.dr.ess:domain.com&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;It’ll announce the address in the event that a tcp connection succeeds as well as a DNS lookup that you’d expect the server should answer or be permitted to recurse for you. If the DNS daemon stops responding the watchdog will withdraw the routes; if the server fails, the BGP session will fail, and the route will be withdrawn anyway.&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>DNSSEC BIND9 Configuration Summary and Cool Stuff</title>
        <published>2010-08-20T00:00:00+00:00</published>
        <updated>2010-08-20T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://karldyson.github.io/karld-blog-website/posts/dnssec-bind-configuration-summary/"/>
        <id>https://karldyson.github.io/karld-blog-website/posts/dnssec-bind-configuration-summary/</id>
        
        <content type="html" xml:base="https://karldyson.github.io/karld-blog-website/posts/dnssec-bind-configuration-summary/">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;&#x2F;h1&gt;
&lt;p&gt;With the recent signing of the root, I’ve discovered a sudden interest in DNSSEC, and decided to have a go myself to aid my understanding of it.&lt;&#x2F;p&gt;
&lt;p&gt;This article is written as an aid-memoir to me, and summary of the bits I’ve read. Of course, I’ve provided links to the whole blog entries I found the information in, in case you want to read more than I’ve written.&lt;&#x2F;p&gt;
&lt;p&gt;Whilst the root is signed, only certain TLDs are signed, and so if you want the full chain of trust experience, you want a domain with a signed TLD.&lt;&#x2F;p&gt;
&lt;p&gt;At the moment, &lt;code&gt;.uk&lt;&#x2F;code&gt; is signed, but &lt;code&gt;.co.uk&lt;&#x2F;code&gt; etc are not, so that rules them out. &lt;code&gt;.net&lt;&#x2F;code&gt; is scheduled for around Nov 2010, and &lt;code&gt;.com&lt;&#x2F;code&gt; sometime around March 2011.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;.org&lt;&#x2F;code&gt;, however, is already signed, and so I thought I’d grab one to play with.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;not-all-registrars-are-equal&quot;&gt;Not All Registrars Are Equal&lt;&#x2F;h1&gt;
&lt;p&gt;I used my regular registrar, and registered &lt;code&gt;karldyson.org&lt;&#x2F;code&gt; to go with my collection of &lt;code&gt;.com&lt;&#x2F;code&gt; and &lt;code&gt;.co.uk&lt;&#x2F;code&gt; versions.&lt;&#x2F;p&gt;
&lt;p&gt;This was my first sticking point, because their upstream (Tucows) aren’t accredited for DNSSEC yet (and, it would appear, have no plans on doing so).&lt;&#x2F;p&gt;
&lt;p&gt;I’d need my domain to be with a registrar that is accredited.&lt;&#x2F;p&gt;
&lt;p&gt;My registrar helpfully supplied me with a list of registrars that are, so I could choose one and either register a domain there, or move my new one.&lt;&#x2F;p&gt;
&lt;p&gt;I registered another .org to add to another set, this time with GoDaddy. They’re on the list.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;signing-the-zone&quot;&gt;Signing The Zone&lt;&#x2F;h1&gt;
&lt;p&gt;I had told GoDaddy that I wanted to use my own nameservers during sign up, and so after creating a regular zonefile for bind, I had a look through the blog entry I found at &lt;a href=&quot;http:&#x2F;&#x2F;clayshek.wordpress.com&#x2F;2009&#x2F;01&#x2F;13&#x2F;enabling-dnssec-on-bind&#x2F;&quot;&gt;http:&#x2F;&#x2F;clayshek.wordpress.com&#x2F;2009&#x2F;01&#x2F;13&#x2F;enabling-dnssec-on-bind&#x2F;&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Essentially, the steps are (all completed whilst IN the zonefile directory):&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Generate a zone signing key (ZSK) :&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;dnssec-keygen -a RSASHA1 -b 1024 -n ZONE example.org&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Generate a key signing key:&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;dnssec-keygen -a RSASHA1 -b 2048 -n ZONE -f KSK example.org&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Concatenate the created public keys into the zone file:&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;cat Kexample.org+*.key &amp;gt;&amp;gt; example.org&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Sign any child zones first:&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;dnssec-signzone -N INCREMENT child.example.org&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Concatenate the DS records for the child into the parent zone:&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;cat dsset-child.example.org &amp;gt;&amp;gt; example.org&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Sign the zone:&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;dnssec-signzone -N INCREMENT example.org&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;Generating the ZSK and KSK took ages on my Atom 330 dedicated server, and so I can recommend a good book, or some other talk while you wait for this to finish!&lt;&#x2F;p&gt;
&lt;p&gt;Like the child zone signing, you will get DS records for the parent zone. These need to be supplied to your registrar to maintain the chain of trust. GoDaddy has a nice interface for submitting these, you just need to know what the different bits of the DS records are. They’re detailed in &lt;a href=&quot;https:&#x2F;&#x2F;datatracker.ietf.org&#x2F;doc&#x2F;html&#x2F;rfc4034&quot;&gt;RFC4034&lt;&#x2F;a&gt; but to save you some time, and sanity….&lt;&#x2F;p&gt;
&lt;h1 id=&quot;your-ds-records&quot;&gt;Your DS Records&lt;&#x2F;h1&gt;
&lt;p&gt;&lt;code&gt;example.org. 86400 IN DS 60485 5 1 2BB183AF5F22588179A53B0A98631FAD1A292118&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;The first four text fields specify the:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;name &lt;code&gt;example.org.&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;TTL &lt;code&gt;86400&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Class &lt;code&gt;IN&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;RR type &lt;code&gt;DS&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;Value &lt;code&gt;60485&lt;&#x2F;code&gt; is the key tag for the corresponding &lt;code&gt;example.org.&lt;&#x2F;code&gt; &lt;kbd&gt;DNSKEY&lt;&#x2F;kbd&gt; RR&lt;&#x2F;p&gt;
&lt;p&gt;Value 5 denotes the algorithm used by this &lt;code&gt;example.org.&lt;&#x2F;code&gt; &lt;kbd&gt;DNSKEY&lt;&#x2F;kbd&gt; RR.&lt;&#x2F;p&gt;
&lt;p&gt;Value 1 is the algorithm used to construct the digest.&lt;&#x2F;p&gt;
&lt;p&gt;The rest of the RDATA text is the digest in hexadecimal.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;your-caching-resolver&quot;&gt;Your Caching Resolver&lt;&#x2F;h1&gt;
&lt;p&gt;Your caching resolver will need DNSSEC enabled for queries. I added the following to my bind server’s options section:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;dnssec-enable yes;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;dnssec-validation yes;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h1 id=&quot;your-system-resolver&quot;&gt;Your System Resolver&lt;&#x2F;h1&gt;
&lt;p&gt;With your local system pointed at your caching resolver, it would appear you’ll need &lt;mark&gt;EDNS0&lt;&#x2F;mark&gt; enabled. This is achieved by adding the following option to your &lt;code&gt;&#x2F;etc&#x2F;resolv.conf&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;options edns0
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This appears to be supported on newer versions of &lt;code&gt;libresolv&lt;&#x2F;code&gt; - my Debian 5 system doesn’t appear to support it, whereas my Ubuntu 10.04 system does.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;so-on-to-the-cool-stuff-ssh&quot;&gt;So, on to the cool stuff… SSH&lt;&#x2F;h1&gt;
&lt;p&gt;..and so, at last, on to the cool stuff.&lt;&#x2F;p&gt;
&lt;p&gt;Given you can now cryptographically trust DNS, you can do something interesting. Rather than need to verify all the SSH fingerprints, you can store them in DNS and have your SSH client automagically verify that all is well.&lt;&#x2F;p&gt;
&lt;p&gt;I followed a set of instructions I found at &lt;a href=&quot;http:&#x2F;&#x2F;blog.exanames.com&#x2F;2009&#x2F;06&#x2F;one-more-thing-to-do-with-dnssec-ssh.html&quot;&gt;http:&#x2F;&#x2F;blog.exanames.com&#x2F;2009&#x2F;06&#x2F;one-more-thing-to-do-with-dnssec-ssh.html&lt;&#x2F;a&gt;, and as before, here’s a summary.&lt;&#x2F;p&gt;
&lt;p&gt;Run the following two comands on each host you’d like to generate fingerprints for:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;ssh-keygen -r `hostname`. -f &#x2F;etc&#x2F;ssh&#x2F;ssh_host_rsa_key
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;ssh-keygen -r `hostname`. -f &#x2F;etc&#x2F;ssh&#x2F;ssh_host_dsa_key
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This will generate two &lt;kbd&gt;SSHFP&lt;&#x2F;kbd&gt; records that you will need to include in the zonefile, then you can re-sign and re-publish the zone.&lt;&#x2F;p&gt;
&lt;p&gt;In my case, the records generated were for .co.uk variants of the hostname, but I found no problems changing them to .org&lt;&#x2F;p&gt;
&lt;p&gt;You’ll then need to persuade SSH to perform verification using DNS. I did this by adding the relevant option to &lt;code&gt;&#x2F;etc&#x2F;ssh&#x2F;ssh_config&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;VerifyHostKeyDNS yes
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;There, you’re done. You should now be able to ssh to the host(s) concerned without needing to manually verify the fingerprints.&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>tcp&#x2F;53 isn&#x27;t just for AXFR</title>
        <published>2010-03-18T00:00:00+00:00</published>
        <updated>2010-03-18T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://karldyson.github.io/karld-blog-website/posts/tcp-53-isnt-just-for-axfr/"/>
        <id>https://karldyson.github.io/karld-blog-website/posts/tcp-53-isnt-just-for-axfr/</id>
        
        <content type="html" xml:base="https://karldyson.github.io/karld-blog-website/posts/tcp-53-isnt-just-for-axfr/">&lt;p&gt;The internet has a defined set of rules known as RFCs. They work together to make sure that all participants of the internet community are working in the same way, and that the things they do as part of that community will work with, and interact correctly with the things that others do.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;datatracker.ietf.org&#x2F;doc&#x2F;html&#x2F;rfc1035#section-4.2.1&quot;&gt;RFC1035 section 4.2.1&lt;&#x2F;a&gt; (UDP Transport) states:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Messages carried by UDP are restricted to 512 bytes (not counting the IP or UDP headers). Longer messages are truncated and the TC bit is set in the header.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;You then fall back to TCP and repeat your query to get the full response.&lt;&#x2F;p&gt;
&lt;p&gt;Yes, AXFR queries are TCP, but TCP isn’t exclusively AXFR!&lt;&#x2F;p&gt;
&lt;p&gt;Assuming that, because you won’t be doing any transfers and therefore don’t need to allow &lt;mark&gt;tcp&#x2F;53&lt;&#x2F;mark&gt;, is wrong, and will invariably involve you having issues with some service or other, due to not getting the correct information from DNS.&lt;&#x2F;p&gt;
&lt;p&gt;I’ll give you an example:&lt;&#x2F;p&gt;
&lt;p&gt;You use a service that, for whatever reason, decides that as a basic form of load balancing, to use multiple A records for the ‘name’ you’ve queried. So, you ask for &lt;code&gt;www.example.com&lt;&#x2F;code&gt; and, rather than give you back a single A record, they give you one for each of their servers. This could easily become longer than 512 bytes, the answer will be truncated, and you &lt;em&gt;should&lt;&#x2F;em&gt; repeat your request using TCP. Your resolver knows this, and will automatically do it.&lt;&#x2F;p&gt;
&lt;p&gt;If you’ve blocked &lt;mark&gt;tcp&#x2F;53&lt;&#x2F;mark&gt; on your firewall, it’ll fail. You’ll sit, staring at your computer, thinking that &lt;code&gt;www.example.com&lt;&#x2F;code&gt; has fallen over, failed in some way, when they have not. It’s not their fault that you’ve not followed the rules.&lt;&#x2F;p&gt;
&lt;p&gt;It’s not just website related records either, email related records (MX, or the TXT for DKIM, DomainKeys or SPF) are other great examples of this…. block &lt;mark&gt;tcp&#x2F;53&lt;&#x2F;mark&gt; from your mail server, and you could quite easily find yourself not receiving email from some senders.&lt;&#x2F;p&gt;
&lt;p&gt;[edited later to add the following]&lt;&#x2F;p&gt;
&lt;p&gt;Further reading (thanks to Duncan for the pointer) of &lt;a href=&quot;https:&#x2F;&#x2F;datatracker.ietf.org&#x2F;doc&#x2F;html&#x2F;rfc1123#section-6.1.3.2&quot;&gt;RFC1123 section 6.1.3.2&lt;&#x2F;a&gt; (Transport Protocols) states:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;DNS resolvers and recursive servers MUST support UDP, and
SHOULD support TCP, for sending (non-zone-transfer) queries.
Specifically, a DNS resolver or server that is sending a
non-zone-transfer query MUST send a UDP query first. If the
Answer section of the response is truncated and if the
requester supports TCP, it SHOULD try the query again using
TCP.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;I guess I’m a little disappointed to see “SHOULD” instead of “MUST”, but given the document was written in 1989, I think today, it should be read as “SHOULD, if you want it to work”. It does go on to say:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Whether it is possible to use a truncated answer depends on the application. A mailer must not use a truncated MX response, since this could lead to mail loops.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
</content>
        
    </entry>
</feed>
